---
import { AD_CONFIG, shouldShowBannerAd } from '../constants/socialCopy';

interface Props {
  slot?: number;
}

const { slot = 1 } = Astro.props;
const { bannerAd } = AD_CONFIG;
const showBanner = shouldShowBannerAd();
---

{showBanner && (
  <div class="ad-banner" data-ad-slot={slot}>
    <div class="ad-content">
      <div class="ad-label">Advertisement</div>
      <div
        class="ad-container"
        id={`ad-container-${slot}`}
        data-ad-key={bannerAd.key}
        data-ad-script={bannerAd.scriptUrl}
        data-ad-height={bannerAd.height}
        data-ad-width={bannerAd.width}
      >
        <!-- Ad will be loaded here -->
      </div>
    </div>
  </div>
)}

<script is:inline>
  (function() {
    // Find all ad containers and initialize ads
    document.querySelectorAll('.ad-container').forEach(function(container) {
      if (container.dataset.adLoaded) return;
      container.dataset.adLoaded = 'true';

      var key = container.dataset.adKey;
      var scriptUrl = container.dataset.adScript;
      var height = parseInt(container.dataset.adHeight) || 90;
      var width = parseInt(container.dataset.adWidth) || 728;

      // Create and inject the ad scripts
      var atOptions = {
        'key': key,
        'format': 'iframe',
        'height': height,
        'width': width,
        'params': {}
      };

      // Store options globally for the invoke script
      window.atOptions = atOptions;

      // Create the invoke script
      var script = document.createElement('script');
      script.src = scriptUrl;
      script.async = true;
      container.appendChild(script);
    });
  })();
</script>

<style>
  .ad-banner {
    grid-column: 1 / -1;
    width: 100%;
    padding: 0.5rem 0;
  }

  .ad-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  .ad-label {
    font-size: 0.6rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: rgba(255, 255, 255, 0.3);
    margin-bottom: 0.25rem;
  }

  .ad-container {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    max-width: 728px;
  }

  .ad-container iframe {
    max-width: 100%;
  }

  @media (max-width: 768px) {
    .ad-container {
      overflow-x: auto;
    }
  }
</style>
